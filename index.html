<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AnemaSales - Sell & Inventory</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <!-- FontAwesome for Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <div id="app" class="app-container">
      <!-- SCREEN: WELCOME -->
      <section id="welcome-screen" class="screen">
        <div class="welcome-content">
          <div class="logo-area">
            <img src="logo.png" alt="AnemaSales Logo" class="brand-icon"> 
            <h1>AnemaSales</h1>
            <p class="tagline">
              Manage your shop, track sales, and grow your business.
            </p>
          </div>
          <div class="bottom-actions">
            <button
              class="btn btn-primary"
              onclick="showScreen('login-screen')"
            >
              Login
            </button>
            <button
              class="btn btn-outline"
              onclick="showScreen('register-screen')"
            >
              Register
            </button>
          </div>
        </div>
      </section>

      <!-- SCREEN: LOGIN -->
      <section id="login-screen" class="screen">
        <div class="header-simple">
          <button class="icon-btn" onclick="showScreen('welcome-screen')">
            <i class="fa-solid fa-arrow-left"></i>
          </button>
          <h2>Login</h2>
        </div>
        <form class="auth-form" onsubmit="handleLogin(event)">
          <div class="form-group">
            <label>Email Address</label>
            <input type="email" placeholder="Email Address" required />
          </div>
          <div class="form-group">
            <label>Password</label>
            <input type="password" placeholder="Password" required />
          </div>
          <button type="submit" class="btn btn-primary btn-block">Login</button>
        </form>
      </section>

      <!-- SCREEN: REGISTER -->
      <section id="register-screen" class="screen">
        <div class="header-simple">
          <button class="icon-btn" onclick="showScreen('welcome-screen')">
            <i class="fa-solid fa-arrow-left"></i>
          </button>
          <h2>Register</h2>
        </div>
        <form class="auth-form" onsubmit="handleRegister(event)">
          <div class="form-group">
            <label>Full Name</label>
            <input type="text" placeholder="Full Name" required />
          </div>
          <div class="form-group">
            <label>Shop Name</label>
            <input type="text" placeholder="Shop Name" required />
          </div>
          <div class="form-group">
            <label>Phone Number</label>
            <input type="tel" placeholder="Phone Number" required />
          </div>
          <div class="form-group">
            <label>Email Address</label>
            <input type="email" placeholder="Email Address" required />
          </div>
          <div class="form-group">
            <label>Password</label>
            <input type="password" placeholder="Password" required />
          </div>
          <button type="submit" class="btn btn-primary btn-block">
            Create Account
          </button>
        </form>
      </section>

      <!-- SCREEN: DASHBOARD -->
      <section id="dashboard-screen" class="screen">
        <div class="app-header">
          <div>
            <h2>My Dashboard</h2>
            <div id="display-shop-name" class="shop-name-badge">Loading...</div>
          </div>
          <button class="icon-btn" onclick="handleLogout()" title="Logout">
            <i
              class="fa-solid fa-right-from-bracket"
              style="color: #ef4444"
            ></i>
          </button>
        </div>

        <div class="dashboard-content">
          <!-- Row 1 -->
          <div class="stat-card">
            <div class="stat-info">
              <span class="label">Total Product(s)</span>
              <h3 class="value" id="dash-total-products">0</h3>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-info">
              <span class="label">Total Shop Value</span>
              <h3 class="value" id="dash-total-value">₦0</h3>
            </div>
          </div>

          <!-- Row 2 -->
          <div class="stat-card">
            <div class="stat-info">
              <span class="label">Total Sales</span>
              <h3 class="value" id="dash-sales-week">₦0</h3>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-info">
              <span class="label">Profit</span>
              <h3 class="value" id="dash-profit">₦0</h3>
            </div>
          </div>

          <!-- Row 3 -->
          <div class="stat-card">
            <div class="stat-info">
              <span class="label">Remaining Products</span>
              <h3 class="value" id="dash-stock-count">0</h3>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-info">
              <span class="label">Remaining Value</span>
              <h3 class="value" id="dash-stock-value">₦0</h3>
            </div>
          </div>
        </div>

        <!-- Bottom Nav -->
        <nav class="bottom-nav">
          <button
            class="nav-item active"
            onclick="showScreen('dashboard-screen')"
          >
            <i class="fa-solid fa-house"></i>
            <span>Home</span>
          </button>
          <button class="nav-item" onclick="showScreen('add-product-screen')">
            <i class="fa-solid fa-plus-circle"></i>
            <span>Add</span>
          </button>
          <button class="nav-item" onclick="showScreen('sell-screen')">
            <i class="fa-solid fa-cart-shopping"></i>
            <span>Sell</span>
          </button>
          <button class="nav-item" onclick="showScreen('credit-screen')">
            <i class="fa-solid fa-book"></i>
            <span>Credit</span>
          </button>
        </nav>
      </section>

      <!-- SCREEN: ADD PRODUCT -->
      <section id="add-product-screen" class="screen">
        <div class="app-header">
          <h2>Add Product</h2>
        </div>
        <div class="content-scrollable">
          <form class="app-form" onsubmit="handleAddProduct(event)">
            <div class="form-group">
              <label>Product Name</label>
              <input
                type="text"
                name="name"
                placeholder="e.g. Wireless Mouse"
                required
              />
            </div>
            <div class="form-group">
              <label>Cost Price (₦)</label>
              <input
                type="text"
                name="costPrice"
                inputmode="decimal"
                class="money-input"
                placeholder="0.00"
              />
            </div>
            <div class="form-group">
              <label>Quantity</label>
              <input type="number" name="quantity" placeholder="0" required />
            </div>
            <button type="submit" class="btn btn-primary btn-block">
              Save Product
            </button>
          </form>

          <div class="manage-products-section">
            <h3 class="section-title">Manage Inventory</h3>
            <div id="inventory-list" class="product-list">
              <!-- Dynamically populated -->
            </div>
          </div>
        </div>
        <!-- Bottom Nav -->
        <nav class="bottom-nav">
          <button class="nav-item" onclick="showScreen('dashboard-screen')">
            <i class="fa-solid fa-house"></i>
            <span>Home</span>
          </button>
          <button
            class="nav-item active"
            onclick="showScreen('add-product-screen')"
          >
            <i class="fa-solid fa-plus-circle"></i>
            <span>Add</span>
          </button>
          <button class="nav-item" onclick="showScreen('sell-screen')">
            <i class="fa-solid fa-cart-shopping"></i>
            <span>Sell</span>
          </button>
          <button class="nav-item" onclick="showScreen('credit-screen')">
            <i class="fa-solid fa-book"></i>
            <span>Credit</span>
          </button>
        </nav>
      </section>

      <!-- SCREEN: SELL -->
      <section id="sell-screen" class="screen">
        <div class="app-header">
          <h2>Sell Product</h2>
        </div>

        <div class="search-bar-container">
          <div class="search-input">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" placeholder="Search by product name..." />
          </div>
          <div style="margin-top: 12px">
            <button
              class="btn btn-block"
              style="
                background: #e5e7eb;
                color: #374151;
                width: 100%;
                border-radius: 8px;
              "
              onclick="showScreen('history-screen')"
            >
              View Sell History
            </button>
          </div>
        </div>

        <div id="sell-product-list" class="product-list">
          <!-- Dynamically populated from productsCache -->
        </div>

        <!-- Bottom Nav -->
        <nav class="bottom-nav">
          <button class="nav-item" onclick="showScreen('dashboard-screen')">
            <i class="fa-solid fa-house"></i>
            <span>Home</span>
          </button>
          <button class="nav-item" onclick="showScreen('add-product-screen')">
            <i class="fa-solid fa-plus-circle"></i>
            <span>Add</span>
          </button>
          <button class="nav-item active" onclick="showScreen('sell-screen')">
            <i class="fa-solid fa-cart-shopping"></i>
            <span>Sell</span>
          </button>
          <button class="nav-item" onclick="showScreen('credit-screen')">
            <i class="fa-solid fa-book"></i>
            <span>Credit</span>
          </button>
        </nav>
      </section>

      <!-- SCREEN: HISTORY -->
      <section id="history-screen" class="screen">
        <div class="header-simple">
          <button class="icon-btn" onclick="showScreen('sell-screen')">
            <i class="fa-solid fa-arrow-left"></i>
          </button>
          <h2>Sales History</h2>
        </div>
        <div class="history-list">
          <!-- Dynamically populated from transactionsCache -->
        </div>
      </section>

      <!-- SCREEN: CREDIT BOOK -->
      <section id="credit-screen" class="screen">
        <div class="app-header">
          <h2>Credit Book</h2>
          <button class="icon-btn" onclick="openAddCreditModal()" title="Add Customer">
            <i class="fa-solid fa-user-plus" style="color: var(--primary);"></i>
          </button>
        </div>

        <div class="credit-summary-cards">
          <div class="credit-stat-card">
            <span class="label">Total Credit</span>
            <h3 class="value" id="total-credit-amount">₦0</h3>
          </div>
          <div class="credit-stat-card">
            <span class="label">Customers</span>
            <h3 class="value" id="total-credit-customers">0</h3>
          </div>
        </div>

        <div class="search-bar-container">
          <div class="search-input">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" id="credit-search" placeholder="Search customers..." />
          </div>
        </div>

        <div id="credit-list" class="credit-list">
          <!-- Dynamically populated from creditsCache -->
        </div>

        <!-- Bottom Nav -->
        <nav class="bottom-nav">
          <button class="nav-item" onclick="showScreen('dashboard-screen')">
            <i class="fa-solid fa-house"></i>
            <span>Home</span>
          </button>
          <button class="nav-item" onclick="showScreen('add-product-screen')">
            <i class="fa-solid fa-plus-circle"></i>
            <span>Add</span>
          </button>
          <button class="nav-item" onclick="showScreen('sell-screen')">
            <i class="fa-solid fa-cart-shopping"></i>
            <span>Sell</span>
          </button>
          <button class="nav-item active" onclick="showScreen('credit-screen')">
            <i class="fa-solid fa-book"></i>
            <span>Credit</span>
          </button>
        </nav>
      </section>

      <!-- SCREEN: CREDIT DETAILS -->
      <section id="credit-detail-screen" class="screen">
        <div class="header-simple">
          <button class="icon-btn" onclick="showScreen('credit-screen')">
            <i class="fa-solid fa-arrow-left"></i>
          </button>
          <h2 id="credit-detail-customer-name">Customer</h2>
          <button class="icon-btn" onclick="deleteCustomer()" title="Delete Customer">
            <i class="fa-solid fa-trash" style="color: #EF4444;"></i>
          </button>
        </div>

        <div class="credit-detail-header">
          <div class="credit-detail-info">
            <p class="customer-phone" id="credit-detail-phone"></p>
            <div class="credit-balance-display">
              <span class="label">Outstanding Balance</span>
              <h2 class="balance-amount" id="credit-detail-balance">₦0</h2>
            </div>
          </div>
          <div class="credit-actions-row">
            <button class="btn btn-primary btn-sm" onclick="openAddTransactionModal()">
              <i class="fa-solid fa-plus"></i> Add Credit
            </button>
            <button class="btn btn-accent btn-sm" onclick="openPaymentModal()">
              <i class="fa-solid fa-money-bill"></i> Record Payment
            </button>
          </div>
        </div>

        <h3 class="section-title" style="padding: 0 16px; margin-top: 20px;">Transaction History</h3>
        <div id="credit-transactions-list" class="credit-transactions-list">
          <!-- Dynamically populated -->
        </div>
      </section>

      <!-- MODAL: SELL -->
      <div id="sell-modal" class="modal-overlay hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3 id="modal-product-name">Sell Product</h3>
            <button class="close-btn" onclick="closeSellModal()">
              &times;
            </button>
          </div>
          <div class="modal-body">
            <p class="stock-info">
              Available: <span id="modal-stock-qty">0</span>
            </p>
            <div class="form-group">
              <label>Sell Price</label>
              <input type="text" id="modal-sell-price" inputmode="decimal" class="money-input" />
            </div>
            <div class="form-group">
              <label>Quantity</label>
              <input type="number" id="modal-sell-qty" value="1" min="1" />
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeSellModal()">
              Cancel
            </button>
            <button class="btn btn-primary" onclick="confirmSell()">
              Display Sell
            </button>
          </div>
        </div>
      </div>

      <!-- MODAL: EDIT PRODUCT -->
      <div id="edit-modal" class="modal-overlay hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Edit Product</h3>
            <button class="close-btn" onclick="closeEditModal()">
              &times;
            </button>
          </div>
          <form id="edit-product-form" onsubmit="handleUpdateProduct(event)">
            <input type="hidden" id="edit-product-id" />
            <div class="modal-body">
              <div class="form-group">
                <label>Product Name</label>
                <input type="text" id="edit-product-name" required />
              </div>
              <div class="form-group">
                <label>Cost Price (₦)</label>
                <input type="text" id="edit-product-cost" inputmode="decimal" class="money-input" />
              </div>
              <div class="form-group">
                <label>Quantity in Stock</label>
                <input type="number" id="edit-product-qty" required />
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                onclick="closeEditModal()"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-primary">
                Update Product
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

      <!-- MODAL: EDIT SALE -->
      <div id="edit-sale-modal" class="modal-overlay hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Edit Sale</h3>
            <button class="close-btn" onclick="closeEditSaleModal()">
              &times;
            </button>
          </div>
          <form id="edit-sale-form" onsubmit="handleUpdateSale(event)">
            <input type="hidden" id="edit-sale-id" />
            <div class="modal-body">
              <p id="edit-sale-product-name" style="font-weight: 600; margin-bottom: 15px; color: var(--primary);"></p>
              <div class="form-group">
                <label>Selling Price (₦)</label>
                <input type="text" id="edit-sale-price" inputmode="decimal" class="money-input" required />
              </div>
              <div class="form-group">
                <label>Quantity Sold</label>
                <input type="number" id="edit-sale-qty" min="1" required />
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" onclick="closeEditSaleModal()">
                Cancel
              </button>
              <button type="submit" class="btn btn-primary">
                Save Changes
              </button>
            </div>
          </form>
        </div>
      </div>

    <!-- MODAL: ADD CUSTOMER -->
    <div id="add-credit-modal" class="modal-overlay hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Add Customer</h3>
          <button class="close-btn" onclick="closeAddCreditModal()">
            &times;
          </button>
        </div>
        <form id="add-credit-form" onsubmit="handleAddCustomer(event)">
          <div class="modal-body">
            <div class="form-group">
              <label>Customer Name</label>
              <input type="text" id="new-customer-name" placeholder="Full Name" required />
            </div>
            <div class="form-group">
              <label>Phone Number</label>
              <input type="tel" id="new-customer-phone" placeholder="08012345678" required />
            </div>
            <div class="form-group">
              <label>Initial Credit Amount (₦)</label>
              <input type="text" id="new-customer-amount" inputmode="decimal" class="money-input" placeholder="0.00" />
            </div>
            <div class="form-group">
              <label>Description (Optional)</label>
              <input type="text" id="new-customer-description" placeholder="e.g., Purchase details" />
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeAddCreditModal()">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">
              Add Customer
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- MODAL: ADD CREDIT TRANSACTION -->
    <div id="add-transaction-modal" class="modal-overlay hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Add Credit</h3>
          <button class="close-btn" onclick="closeAddTransactionModal()">
            &times;
          </button>
        </div>
        <form id="add-transaction-form" onsubmit="handleAddCreditTransaction(event)">
          <div class="modal-body">
            <div class="form-group">
              <label>Amount (₦)</label>
              <input type="text" id="transaction-amount" inputmode="decimal" class="money-input" placeholder="0.00" required />
            </div>
            <div class="form-group">
              <label>Description</label>
              <input type="text" id="transaction-description" placeholder="e.g., Purchased items" required />
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeAddTransactionModal()">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">
              Add Credit
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- MODAL: RECORD PAYMENT -->
    <div id="payment-modal" class="modal-overlay hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Record Payment</h3>
          <button class="close-btn" onclick="closePaymentModal()">
            &times;
          </button>
        </div>
        <form id="payment-form" onsubmit="handleRecordPayment(event)">
          <div class="modal-body">
            <p class="stock-info">
              Outstanding: <span id="payment-modal-balance">₦0</span>
            </p>
            <div class="form-group">
              <label>Payment Amount (₦)</label>
              <input type="text" id="payment-amount" inputmode="decimal" class="money-input" placeholder="0.00" required />
            </div>
            <div class="form-group">
              <label>Note (Optional)</label>
              <input type="text" id="payment-note" placeholder="e.g., Cash payment" />
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closePaymentModal()">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">
              Record Payment
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Loader Overlay -->
    <div id="loader-overlay" style="display: flex;">
      <div class="spinner"></div>
      <p id="loader-status" style="color: var(--primary); font-weight: 600; margin-top: 10px">
        Loading AnemaSales...
      </p>
      <div id="retry-container" class="hidden" style="margin-top: 15px; text-align: center;">
        <button class="btn btn-outline btn-sm" onclick="window.location.reload()">
          <i class="fa-solid fa-rotate-right" style="margin-right: 8px;"></i> Retry Loading
        </button>
      </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <script type="module" src="app.js"></script>
  </body>
</html>
